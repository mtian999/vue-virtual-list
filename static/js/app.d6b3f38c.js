(function(){"use strict";var t={321:function(t,e,i){var n=i(83),r=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app"}},[e("input",{staticStyle:{position:"absolute","z-index":"1"},attrs:{type:"text"},on:{input:t.changeHandle}}),e("BaseVirtualList",t._g(t._b({ref:"refBaseVirtualList",attrs:{realData:t.listData,isUnfreeze:!0},scopedSlots:t._u([{key:"default",fn:function(i){var n=i.item;return[e("div",{staticClass:"list-item",style:{backgroundColor:n.color},on:{click:function(e){return t.clickHandle(n)}}},[t._v(" "+t._s(n.content)+" ")])]}}])},"BaseVirtualList",t.$attrs,!1),t.$listeners))],1)},a=[],o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container",style:t.containerStyle},[e("div",{ref:"virtualList",staticClass:"virtual-list-container",on:{scroll:function(e){return e.preventDefault(),t.virtualScroll.apply(null,arguments)}}},[e("div",{staticClass:"virtual-list-box",style:t.virtualBoxStyle},[e("div",{staticClass:"content",style:t.virtualStyle},t._l(t.renderList,(function(i){return e("item",{key:i[t.keyName],staticClass:"content-item",attrs:{data:i,"fixed-height":!1,index:i.index},on:{itemMounted:t.itemMountedHandle,itemSizeChange:t.itemSizeChangeHandle,itemSizeChangeEnd:t.itemSizeChangeEndHandle,itemDestroyed:t.itemDestroyedHandle,delDestroyedList:t.delDestroyedListHandle}},[t._t("default",null,{item:i})],2)})),1)]),t._t("virtualListExtra")],2),e("div",{staticClass:"destroyed-but-need-show"},[t.dataRowHeader?[t._t("default",null,{item:t.dataRowHeader})]:t._e()],2),e("div",{staticClass:"preview-item"},[t.headPreviewItem?[e("item",{key:t.headPreviewItem.key,ref:"refHeadPreviewItem",attrs:{data:t.headPreviewItem},on:{itemSizeChange:t.headPreviewItemSizeChangeHandle,itemMounted:t.headPreviewItemMountedHandle}},[t._t("default",null,{item:t.headPreviewItem})],2)]:t._e()],2)])},s=[],l=i(70),d=function(){var t=this,e=t._self._c;return e("div",{ref:"item",staticClass:"item"},[t._t("default")],2)},h=[],u=i(392),f={name:"BaseVirtualListItem",props:{index:{type:Number,default:0},data:{type:Object,default:function(){return{}}}},data:function(){return{initItemHeight:0}},destroyed:function(){this.$emit("itemDestroyed",this.data)},created:function(){this.itemSizeChangeEndHandle=(0,l.debounce)(this.itemSizeChangeEndHandle,50,{leading:!1,trailing:!0})},mounted:function(){var t=this;this.initItemHeight=this.$refs.item.offsetHeight;var e=new u.Z((function(){var e=t.$refs.item.offsetHeight;e!==t.initItemHeight&&t.itemSizeChangeEndHandle({itemData:t.data,itemHeight:e}),t.itemSizeChangeHandle({itemData:t.data,itemHeight:e})}));e.observe(this.$refs.item),this.$once("hook:beforeDestroy",e.disconnect.bind(e)),"dataRow"===this.data.type&&this.$emit("delDestroyedList",this.data);var i=this.initItemHeight;this.$emit("itemMounted",{itemData:this.data,itemHeight:i})},methods:{itemSizeChangeHandle:function(t){var e=t.itemData,i=t.itemHeight;this.$emit("itemSizeChange",{itemData:e,itemHeight:i})},itemSizeChangeEndHandle:function(t){var e=t.itemData,i=t.itemHeight;this.initItemHeight=i,this.$emit("itemSizeChangeEnd",{itemData:e,itemHeight:i})}}},c=f,m=i(736),v=(0,m.Z)(c,d,h,!1,null,"733d83c4",null),g=v.exports;function p(t){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},p(t)}function y(t){return b(t)||H(t)||D(t)||I()}function I(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function H(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function b(t){if(Array.isArray(t))return S(t)}function _(t,e){return x(t)||z(t,e)||D(t,e)||w()}function w(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function D(t,e){if(t){if("string"===typeof t)return S(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?S(t,e):void 0}}function S(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function z(t,e){var i=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=i){var n,r,a,o,s=[],l=!0,d=!1;try{if(a=(i=i.call(t)).next,0===e){if(Object(i)!==i)return;l=!1}else for(;!(l=(n=a.call(i)).done)&&(s.push(n.value),s.length!==e);l=!0);}catch(h){d=!0,r=h}finally{try{if(!l&&null!=i.return&&(o=i.return(),Object(o)!==o))return}finally{if(d)throw r}}return s}}function x(t){if(Array.isArray(t))return t}function O(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function L(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?O(Object(i),!0).forEach((function(e){C(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):O(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function C(t,e,i){return e=R(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function R(t){var e=j(t,"string");return"symbol"===p(e)?e:String(e)}function j(t,e){if("object"!==p(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!==p(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var P=100,T=0,k=2,M=k+1,N={advanced:66,dataRow:85,dataRowItem:40,select:0,text:66,group:46};function U(t,e){for(var i=e.split("."),n=t,r=0;r<i.length;r++)if(n=n[i[r]],void 0===n)break;return n}function $(t){var e=t.lastIndexOf(".");return-1===e?[t,""]:[t.substr(0,e),t.substr(e+1)]}var A=function(t,e){var i=t.length,n=0,r=i-1,a=null;while(n<=r){var o=n+r>>1,s=t[o]._nodeInfo._topNum+t[o]._nodeInfo._height,l=s;if(l===e)return o;l<e?n=o+1:((null===a||a>o)&&(a=o),r--)}return a},F={name:"BaseVirtualList",components:{Item:g},props:{realData:{type:Array,default:function(){return[]}},keyName:{type:String,default:"key"},isUnfreeze:{type:Boolean,default:!0},freezeKeyName:{type:[String,Array]},virtualListHeight:{type:[Number,String]}},data:function(){return{currentRealData:[],screenHeight:0,preItemHeight:50,totalHeight:0,virtualStyle:{},scrollTopVal:0,renderList:[],renderStartNode:{index:0,scrollOffset:0},headPreviewItem:null,destroyedData:{},showKey:"",waitFrozenList:[],isHasWaitFrozenList:new WeakMap,isFreezing:!1,waitScrollOffsetData:{offsetScroll:0,isScrollToTarget:!1},isSizeChange:!1,isUpdatingHeadPreviewItem:!1,isUpdatingRealHeight:!1,waitUpdateItemMinIdx:0,isAmendScrollTop:!1}},computed:{realDataLen:function(){return this.realData.length},containerStyle:function(){var t=this.virtualListHeight;return t?("[object Number]"===Object.prototype.toString.call(t)&&(t+="px"),{height:t}):{height:"100%"}},virtualBoxStyle:function(){return{minHeight:"".concat(this.totalHeight,"px")}},dataRowHeader:function(){var t;return this.showKey&&(t=this.destroyedData[this.showKey]),t}},watch:{"renderStartNode.index":{handler:function(t){var e;this.headPreviewItem=null;var i=t,n=this.currentRealData[i-1];n&&(e=L({},n),e._nodeInfo=L({},n._nodeInfo)),this.headPreviewItem=e}},dataRowHeader:function(t){t&&(this.waitScrollOffsetData=Object.assign({},this.waitScrollOffsetData,{offsetScroll:-1*t._nodeInfo._height}))},waitScrollOffsetData:function(t){var e=this;this.$nextTick((function(){if(t.isScrollToTarget&&t.offsetScroll){var i=t.offsetScroll;void 0!==i&&e.offsetScrollHandle(i),e.waitScrollOffsetData.isScrollToTarget=!1}}))},realData:{handler:function(){this.initRender()}}},created:function(){this.itemSizeChangeEndHandle=(0,l.debounce)(this.itemSizeChangeEndHandle,50,{leading:!1,trailing:!0}),this.debounceFrozenDataProcessByCompatible=(0,l.throttle)(this.frozenDataProcessByCompatible,5e3,{leading:!1})},mounted:function(){this.initRender(),window.bv=this},methods:{initRender:function(){var t=this;this.renderList=[],this.initCurrentRealDataAndRealHeight(),this.$nextTick((function(){t.getRenderList()}))},addDestroyedListHandle:function(t){this.$set(this.destroyedData,t.key,t)},delDestroyedListHandle:function(t){this.$delete(this.destroyedData,t.key)},setDestroyedListShowOrderHandle:function(t){"dataRowItem"===t.type&&(this.showKey=t.rowDataKey)},headPreviewItemMountedHandle:function(t){var e=t.itemData,i=t.itemHeight;if(!1===this.isUpdatingHeadPreviewItem){this.isUpdatingHeadPreviewItem=!0;var n=this.currentRealData[e.index];!n||n._nodeInfo._height===i&&!0!==n._nodeInfo._isInitialHeight||(n._nodeInfo._height=i,n._nodeInfo._isInitialHeight=!1,this.waitUpdateItemMinIdx>n.index&&(this.waitUpdateItemMinIdx=n.index)),this.waitUpdateItemMinIdx<this.realDataLen&&this.updateRealHeight(),this.isUpdatingHeadPreviewItem=!1}},headPreviewItemSizeChangeHandle:function(t){var e=t.itemData,i=t.itemHeight,n=this.currentRealData[e.index];n._nodeInfo._height===i&&!0!==n._nodeInfo._isInitialHeight||(n._nodeInfo._height=i,n._nodeInfo._isInitialHeight=!1,this.waitUpdateItemMinIdx>e.index&&(this.waitUpdateItemMinIdx=e.index))},itemMountedHandle:function(){this.itemSizeChangeEndHandle()},itemSizeChangeEndHandle:function(){N=Object.assign({},N,this.getAverageCompPreHeight(this.currentRealData)),this.updateRealHeight()},itemSizeChangeHandle:function(t){var e=t.itemData,i=t.itemHeight;e._nodeInfo._height===i&&!0!==e._nodeInfo._isInitialHeight||(this.isSizeChange=!0,e._nodeInfo._height=i,e._nodeInfo._isInitialHeight=!1,this.waitUpdateItemMinIdx>e.index&&(this.waitUpdateItemMinIdx=e.index))},itemDestroyedHandle:function(t){if(this.isUnfreeze||this.freezeKeyName){var e=t,i=this.isHasWaitFrozenList.has(e);i||(this.waitFrozenList.push(e),this.isHasWaitFrozenList.set(e)),this.frozenDataHandle()}},frozenDataHandle:function(){this.isFreezing||(this.isFreezing=!0,window.requestIdleCallback?requestIdleCallback(this.frozenDataProcess):this.debounceFrozenDataProcessByCompatible())},frozenDataProcess:function(t){this.isFreezing=!1;while(t.timeRemaining()>30&&this.waitFrozenList.length>T){var e=this.waitFrozenList.shift();this.isHasWaitFrozenList.delete(e),this.isUnfreeze&&this.freezeHandle(this.currentRealData,e,this.freezeKeyName)}this.waitFrozenList.length>T&&this.frozenDataHandle()},frozenDataProcessByCompatible:function(){this.isFreezing=!1;while(this.waitFrozenList.length>T){var t=this.waitFrozenList.shift(),e=Object.isFrozen(t.children);!1===e&&(t.children=Object.freeze((0,l.cloneDeep)(t.children)))}},virtualScroll:function(t){var e=t.target.scrollTop-this.scrollTopVal;this.scrollTopVal+=e,!1===this.isAmendScrollTop&&this.getRenderList(),this.isAmendScrollTop=!1},initCurrentRealDataAndRealHeight:function(){for(var t=0,e=0;e<this.realDataLen;e++){var i=L({},this.realData[e]);void 0===i._nodeInfo&&(i._nodeInfo={}),i.index=e,i._nodeInfo._topNum=t,void 0===i._nodeInfo._height&&(i._nodeInfo._height=N[i.type]||this.preItemHeight,i._nodeInfo._isInitialHeight=!0),t+=i._nodeInfo._height,this.isUnfreeze?this.currentRealData[e]=i:this.currentRealData[e]=Object.freeze(i)}this.totalHeight=t},updateRealHeight:function(){var t,e=this,i=this.realDataLen;if(this.waitUpdateItemMinIdx!==i){var n=this.waitUpdateItemMinIdx;this.waitUpdateItemMinIdx=i;var r=n;if(!this.isUpdatingRealHeight){this.isUpdatingRealHeight=!0;for(var a=0,o=i,s=this.currentRealData[this.renderStartNode.index]._nodeInfo._height,l=r;l<o;l++){var d=this.currentRealData[l],h=this.currentRealData[l-1];if(!0===d._nodeInfo._isInitialHeight){var u=N[d.type]||this.preItemHeight;d._nodeInfo._height!==u&&(d._nodeInfo._height=u)}d._nodeInfo._topNum=h?h._nodeInfo._topNum+h._nodeInfo._height:0,a=d._nodeInfo._topNum+d._nodeInfo._height}this.totalHeight=a;var f=(null===(t=this.currentRealData[this.renderStartNode.index])||void 0===t?void 0:t._nodeInfo._topNum)+this.renderStartNode.scrollOffset,c=this.$refs.virtualList;console.log("sizeChange",n,this.renderStartNode.index,s),c&&c.scrollTop!==f?(this.isAmendScrollTop=!0,this.$nextTick((function(){var t;e.$refs.virtualList.scrollTop=f,e.virtualStyle={transform:"translate3d(0, ".concat(null===(t=e.currentRealData[e.renderStartNode.index])||void 0===t?void 0:t._nodeInfo._topNum,"px, 0)")}}))):this.getRenderList(),c=null,this.isUpdatingRealHeight=!1}}},findCenterIndex:function(t,e){var i,n=0;(n=A(e,t)||0,0===n)&&(t>(null===(i=e[e.length-1])||void 0===i?void 0:i._nodeInfo._topNum)&&(n=e.length-1>=0?e.length-1:0));return n},offsetScrollHandle:function(t){t&&(this.$refs.virtualList.scrollTop=this.$refs.virtualList.scrollTop+t)},scrollToTargetHandle:function(t){this.updateRealHeight();var e=this.currentRealData.find((function(e){return e.index===t}));e&&this.scrollToIndex(e)},scrollToIndex:function(t){this.$refs.virtualList.scrollTop=t._nodeInfo._topNum,this.scrollTopVal=t._nodeInfo._topNum,this.waitScrollOffsetData=Object.assign({},this.waitScrollOffsetData,{isScrollToTarget:!0})},getRenderList:function(){var t,e,i,n,r,a=this.scrollTopVal,o=this.findCenterIndex(a,this.currentRealData)-k;o<0&&(o=0);var s=(null===(t=this.currentRealData[o])||void 0===t?void 0:t._nodeInfo._topNum)||0;if(this.renderStartNode={index:o,scrollOffset:a-s},o!==(null===(e=this.renderList)||void 0===e||null===(i=e[0])||void 0===i?void 0:i.index)||!1!==this.isSizeChange){this.isSizeChange=!1,this.virtualStyle={transform:"translate3d(0, ".concat(s,"px, 0)")};var l=P,d=o+l;d=Math.min(d,this.realDataLen);var h=0,u=0,f=!1,c=[];0===this.screenHeight&&(this.screenHeight=this.$refs.virtualList.offsetHeight);for(var m=o;m<d;m++){var v=this.currentRealData[m],g=this.currentRealData[m+1],p=v._nodeInfo._height,y=(null===g||void 0===g?void 0:g._nodeInfo._height)||0;if(p<1.5*this.screenHeight&&(h+=p),p>u&&(u=p),y>u&&(u=y),!(h<1.5*this.screenHeight))break;this.isUnfreeze&&this.unfreezeHandle(this.currentRealData,v,this.freezeKeyName),c.push(v),h+y>1.5*this.screenHeight&&(f||(f=!0,h-=u))}if(o!==(null===(n=this.renderList)||void 0===n||null===(r=n[0])||void 0===r?void 0:r.index)||this.renderList.length!==c.length){if(c){var I=c.find((function(t){return"dataRowItem"===t.type}));if(I){var H=c.find((function(t){return t.key===I.rowDataKey}));void 0===H&&void 0===this.destroyedData[I.rowDataKey]&&(H=this.currentRealData.find((function(t){return t.key===I.rowDataKey})),H&&this.$set(this.destroyedData,I.rowDataKey,H)),this.setDestroyedListShowOrderHandle(I)}else this.destroyedData={}}var b=c[c.length-1];if(b)for(var _=b.index,w=_+1,D=w;D<w+M;D++){var S=this.currentRealData[D];S&&c.push(S)}this.renderList=c}}},unfreezeHandle:function(t,e,i){var n=[];i?(n=n.concat(i),n.forEach((function(t){var i=U(e,t);if(i){var n=Object.isFrozen(i);if(!0===n){var r=$(t),a=_(r,2),o=a[0],s=a[1],l=i;l=Array.isArray(i)?y(i):L({},i),""===s?e[o]=l:U(e,o)[s]=l}}}))):Object.isFrozen(e)&&(t[e.index]=L({},e))},freezeHandle:function(t,e,i){var n=[];i?(n=n.concat(i),n.forEach((function(i){var n=U(e,i);if(n){var r=Object.isFrozen(n);if(!1===r){var a=$(i),o=_(a,2),s=o[0],d=o[1],h=Object.freeze((0,l.cloneDeep)(n));""===d?e[s]=h:U(e,s)[d]=h}t[e.index]=L({},e)}}))):t[e.index]=(0,l.cloneDeep)(e)},getAverageCompPreHeight:function(t){for(var e={},i={},n=0;n<t.length;n++){var r=t[n];void 0===e[r.type]&&(e[r.type]={totalHeight:0,count:0}),!1===r._nodeInfo._isInitialHeight&&(e[r.type].totalHeight+=r._nodeInfo._height,e[r.type].count+=1)}return Object.keys(e).forEach((function(t){var n=e[t],r=n.totalHeight,a=n.count;a>0&&(i[t]=Math.floor(r/a))})),i}}},E=F,B=(0,m.Z)(E,o,s,!1,null,"5ee47b12",null),K=B.exports;function V(t){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i="",n=0;n<t;n++)i+=e.charAt(parseInt(Math.random()*e.length));return i}function Z(t,e){var i=Math.floor(Math.random()*(t-e+1))+e;return i}function W(){var t=Math.floor(255*Math.random()),e=Math.floor(255*Math.random()),i=Math.floor(255*Math.random());return"rgba("+t+","+e+","+i+",0.8)"}function q(){for(var t=[],e=0;e<1e4;e++){var i=V(Z(500,50));t.push({key:e,content:i,color:W(),type:"div"})}return Object.freeze(t)}var G={name:"App",components:{BaseVirtualList:K},data:function(){return{listData:[]}},mounted:function(){var t=this;setTimeout((function(){t.listData=q()}),500)},methods:{clickHandle:function(t){t.content=V(Z(500,50)),t.color=W()},changeHandle:function(t){var e=parseInt(t.target.value);isNaN(e)||(console.log(e),this.$refs.refBaseVirtualList.scrollToTargetHandle(e))}}},J=G,Q=(0,m.Z)(J,r,a,!1,null,null,null),X=Q.exports;n.ZP.config.productionTip=!1,new n.ZP({render:function(t){return t(X)}}).$mount("#app")}},e={};function i(n){var r=e[n];if(void 0!==r)return r.exports;var a=e[n]={id:n,loaded:!1,exports:{}};return t[n].call(a.exports,a,a.exports,i),a.loaded=!0,a.exports}i.m=t,function(){i.amdO={}}(),function(){var t=[];i.O=function(e,n,r,a){if(!n){var o=1/0;for(h=0;h<t.length;h++){n=t[h][0],r=t[h][1],a=t[h][2];for(var s=!0,l=0;l<n.length;l++)(!1&a||o>=a)&&Object.keys(i.O).every((function(t){return i.O[t](n[l])}))?n.splice(l--,1):(s=!1,a<o&&(o=a));if(s){t.splice(h--,1);var d=r();void 0!==d&&(e=d)}}return e}a=a||0;for(var h=t.length;h>0&&t[h-1][2]>a;h--)t[h]=t[h-1];t[h]=[n,r,a]}}(),function(){i.d=function(t,e){for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){i.nmd=function(t){return t.paths=[],t.children||(t.children=[]),t}}(),function(){var t={143:0};i.O.j=function(e){return 0===t[e]};var e=function(e,n){var r,a,o=n[0],s=n[1],l=n[2],d=0;if(o.some((function(e){return 0!==t[e]}))){for(r in s)i.o(s,r)&&(i.m[r]=s[r]);if(l)var h=l(i)}for(e&&e(n);d<o.length;d++)a=o[d],i.o(t,a)&&t[a]&&t[a][0](),t[a]=0;return i.O(h)},n=self["webpackChunkvue_virtual_list"]=self["webpackChunkvue_virtual_list"]||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))}();var n=i.O(void 0,[998],(function(){return i(321)}));n=i.O(n)})();
//# sourceMappingURL=app.d6b3f38c.js.map